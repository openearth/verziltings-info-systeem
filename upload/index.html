<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html lang="en"> 
<head> 
    <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
    <title>Verzilting document upload</title> 
    
    <script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous">
    </script>

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.js'></script>
    <!-- script
        src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.min.js">
    </script -->
    <link href="form.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel='stylesheet' href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.css'/>

    <script>
        function callback(data)
        {
            console.log(data)
            $("#document_upload")[0].reset();
        }

        $(document).ready( function() {
            
            var url = new URL(window.location);
            var formData = url.searchParams.get("data");
            
            if (formData && formData.length > 0)
            {
                var json = JSON.parse(atob(formData));
                for (name in json)
                {
                    $('#document_upload input[name='+name+']').val(json[name]);
                }
                
                console.log(json);
            }
                        
            $('#document_upload').submit(function(evt) {
                evt.preventDefault();
                
                var formContent = new FormData(this);
                var formAction = $(this).attr('action');
                var formSubmitType = $(this).attr('method');
                
                var request = new XMLHttpRequest();
                request.open("POST", formAction);
                request.send(formContent);
                
                request.onload = function()
                {
                    if (request.status == 200) {
                        $("form").hide();
                        $("#succes").show();
                    }
                    else
                    {
                        $("form").hide();
                        console.log(e);
                        $("#failed p").html(error)
                        $("#failed").show();
                    }
                }

                return false; // prevent form from submitting
            });
            $('#try-again').click( function()
            {
               $("#failed").hide();
               $("form").show();
                return false;
            })
                                  
        });    
    </script>
</head> 
<body> 
    <form id="document_upload" action="../php/verzilting.php" method="POST">
    <fieldset id="document">
        <h2>Upload uw document</h2>
        <p>
            Dit formulier staat toe een document toe te voegen aan de kennisbank verzilting.
            Uw naam en organisatie zijn bedoelt om een aanspreekpunt te hebben mochten er vragen zijn.
            Uw naam en organisatie worden niet publiekelijk weergegeven in de site zelf.
        </p>
        <label for="creator">Uw naam</label>
        <input type="text" name="creator"/>
        <label for="organisation">Uw Organisatie</label>
        <input type="text" name="organisation"/>
        <label for="title">Document titel</label>
        <input type="text" name="title"/>
        <label for="project">In kader van welk project?</label>
        <input type="text" name="project"/>
        <label for="author">Auteur</label>
        <input type="text" name="author"/>
        <label for="abstract">Een korte omschrijving in maximaal 4 zinnen</label>
        <textarea type="textbox" name="abstract"></textarea>
        <label for="waterbody-map">Waterlichaam connectie</label>
        <div name="waterbody-map" id="select-waterbody-map">
          <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.min.js'></script>
          <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.css' type='text/css' />
          <script src='select-waterbody-map.js'></script>
        </div>
        <input type="text" id="waterbody" name="waterbody" readonly style="border:none;"/>
        <label for="document">Upload document</label>
        <input id="input_file" type="file" name="document">
        <input hidden value="" name="pass"/>
    </fieldset>
         <button type="submit">Upload</button>
    </form>
    <div id="succes" style="display:none">
        <h2>Success: uw document is toegevoegd in de kennisbank</h2>
        <p>
            Wilt u nog een document-uploaden?
            <a href=".">Upload nog een document</a>
        </p>
    </div>
    <div id="failed" style="display:none">
        <h2>Helaas is er iets fout gegaan in het proces.</h2>
        <p>
            
        </p>
        <a href="#" id="try-again">Probeer nog een keer</a>
    </div>
</body>
</html>
